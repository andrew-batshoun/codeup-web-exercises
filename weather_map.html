<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Project</title>
    <!--mapbox -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet'/>
    <!--bootstrap stylesheet-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <style>
        #weather-cards {
            display: flex;

            justify-content: space-around;
        }

        #map {


        }
    </style>
</head>
<body>
<nav class="navbar navbar-dark bg-primary">
    <a class="navbar-brand location"></a>
    <form class="form-inline">
        <input class="form-control mr-sm-2 search" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0 submit-search" type="submit">Search</button>
    </form>
</nav>

<div class="row" id="weather-cards"></div>


<div class="card-body d-flex justify-content-center ">

    <div id='map' style='width: 1200px; height: 400px; border: 2px blue solid;'></div>
</div>


<!--TOKEN KEYS-->
<script src="js/keys.js"></script>
<!--bootstrap and jquery-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
<!-- Mapbox Geocoder Util Methods -->
<script src="js/mapbox-geocoder-utils.js"></script>
<!--inline script-->
<script>
    function getWeather(lat, lon) {

        $.get("http://api.openweathermap.org/data/2.5/onecall", {
            APPID: WEATHER_KEY,
            lat: 29.423017,
            lon: -98.48527,
            units: "imperial"
        }).done(function (data) {
            console.log(data)
            for (let i = 0; i < 5; i++) {
                var weatherDay = new Date(data.daily[i].dt * 1000).toString();
                var weatherIcon = "http://openweathermap.org/img/wn/" + data.daily[i].weather[0].icon + "@2x.png";
                console.log(weatherIcon);

                let html = "";
                html += '<div class="card border-primary" style="width: 14rem;">'
                html += '<div class="card-header text-center">' + weatherDay.substring(0, 4) + '</div>';
                html += '<div class="card-body text-center">' + '<div>' + data.daily[i].temp.min + "&#176F" + ' / ' + data.daily[i].temp.max + "&#176F" + '</div>';
                html += '<div>' + '<img class ="icon" src="" alt="weather icon">' + '</div>' + '</div>';
                html += '<ul class="list-group list-group-flush">';
                html += '<li class="list-group-item text-center">' + 'Description: ' + '<p class = "text-center" style="font-weight: bold">' + data.daily[i].weather[0].description + '</p>' + '</li>';
                html += '<li class="list-group-item">' + "Humidity: " + '<span style="font-weight: bold"> ' + data.daily[i].humidity + ' </span>' + '</li>';
                html += '<li class="list-group-item">' + "Wind: " + '<span style="font-weight: bold">' + data.daily[i].wind_speed + '</span>' + '</li>';
                html += '<li class="list-group-item">' + "Pressure: " + '<span style="font-weight: bold">' + data.daily[i].pressure + '</span>' + '</li>' + '</ul>' + '</div>';

                $('#weather-cards').append(html);
                $('.icon').attr("src", weatherIcon)

            }

        }).fail(function (jqXhr, status, error) {
            alert("There was an error! Check the console for details");
            console.log("Response status: " + status);
            console.log("Error object: " + error);
        });
    }

    mapboxgl.accessToken = MAPBOX_KEY;
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/navigation-day-v1',
        center: [-98.4683, 29.5312],
        zoom: 9
    });

    $('.submit-search').click(function (event) {
        event.preventDefault()
        var input = {address: $('.search').val()};
        console.log(input)

        function placeMarker(info, token, map) {
            geocode(info.address, token).then(function (coordinates) {
                console.log(coordinates)
                const latLon = coordinates;
                var marker = new mapboxgl.Marker()
                    .setLngLat(coordinates)
                    .addTo(map);
                map.flyTo({
                    center: [coordinates[0], coordinates[1]],
                    zoom: 9,

                });
                // getWeather(coordinates[0], coordinates[1]);
            });
        }

        placeMarker(input, MAPBOX_KEY, map);
    })


</script>
</body>
</html>